<script>
  let answer = [];
  let turn = 0;

  function generateAnswer() {
    const digits = [];
    while (digits.length < 3) {
      const rand = Math.floor(Math.random() * 10);
      if (!digits.includes(rand)) digits.push(rand);
    }
    return digits;
  }

  function toggleMenu() {
    const menu = document.getElementById("menuList");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
  }

  function showSection(id) {
    document.querySelectorAll(".section").forEach(sec => sec.style.display = "none");
    document.getElementById("section-" + id).style.display = "block";
    document.getElementById("gameUI").style.display = "none";
    document.getElementById("startBtn").style.display = "block";
    document.getElementById("description").style.display = "block";
    document.getElementById("startBtn").style.marginTop = "30px";
    document.getElementById("startBtn").style.position = "relative";
  }

  function startGame() {
    answer = generateAnswer(); // ★バグ修正ポイント！
    turn = 0;
    document.getElementById("gameUI").style.display = "block";
    document.getElementById("startBtn").style.display = "none";
    document.getElementById("description").style.display = "none";
    document.querySelectorAll(".section").forEach(sec => sec.style.display = "none");
    document.getElementById("log").innerHTML = "";
  }

  function playGame() {
    const input = document.getElementById("guess").value;
    if (!/^\d{3}$/.test(input)) {
      alert("3ケタの数字を入れてね！");
      return;
    }

    turn++;
    const guess = input.split("").map(Number);
    let hit = 0, blow = 0;

    for (let i = 0; i < 3; i++) {
      if (guess[i] === answer[i]) {
        hit++;
      } else if (answer.includes(guess[i])) {
        blow++;
      }
    }

    const log = document.getElementById("log");
    log.innerHTML += `<p>予想: ${input} → ${hit} Hit / ${blow} Blow</p>`;

    if (hit === 3) {
      log.innerHTML += `<p class="correct">🎉 正解！</p>`;
      answer = generateAnswer();
      turn = 0;
    }

    document.getElementById("guess").value = '';
  }

  function restartGame() {
    answer = generateAnswer();
    turn = 0;
    document.getElementById("log").innerHTML = '';
    document.getElementById("guess").value = '';
  }
</script>
